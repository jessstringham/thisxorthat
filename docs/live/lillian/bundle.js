(()=>{"use strict";var t={256:(t,e,n)=>{t.exports=n.p+"6ef09654c26351599fc4.wasm"}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,n),a.exports}let r;function o(t){const e=r.__externref_table_alloc();return r.__wbindgen_export_2.set(e,t),e}function a(t,e){try{return t.apply(this,e)}catch(t){const e=o(t);r.__wbindgen_exn_store(e)}}function s(t,e){try{return t.apply(this,e)}catch(t){let e=function(){try{return t instanceof Error?`${t.message}\n\nStack:\n${t.stack}`:t.toString()}catch(t){return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",e),t}}n.m=t,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=r[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.b=document.baseURI||self.location.href;const i="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&i.decode();let l=null;function c(){return null!==l&&0!==l.byteLength||(l=new Uint8Array(r.memory.buffer)),l}function d(t,e){return t>>>=0,i.decode(c().subarray(t,t+e))}let u=0;const _="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},m="function"==typeof _.encodeInto?function(t,e){return _.encodeInto(t,e)}:function(t,e){const n=_.encode(t);return e.set(n),{read:t.length,written:n.length}};function f(t,e,n){if("string"!=typeof t)throw new Error("expected a string argument, found "+typeof t);if(void 0===n){const n=_.encode(t),r=e(n.length,1)>>>0;return c().subarray(r,r+n.length).set(n),u=n.length,r}let r=t.length,o=e(r,1)>>>0;const a=c();let s=0;for(;s<r;s++){const e=t.charCodeAt(s);if(e>127)break;a[o+s]=e}if(s!==r){0!==s&&(t=t.slice(s)),o=n(o,r,r=s+3*t.length,1)>>>0;const e=c().subarray(o+s,o+r),a=m(t,e);if(a.read!==t.length)throw new Error("failed to pass whole string");s+=a.written,o=n(o,r,s,1)>>>0}return u=s,o}let h=null;function p(){return(null===h||!0===h.buffer.detached||void 0===h.buffer.detached&&h.buffer!==r.memory.buffer)&&(h=new DataView(r.memory.buffer)),h}function g(t){return null==t}function w(t){if("boolean"!=typeof t)throw new Error("expected a boolean argument, found "+typeof t)}const b="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((t=>{r.__wbindgen_export_6.get(t.dtor)(t.a,t.b)}));function v(t){const e=typeof t;if("number"==e||"boolean"==e||null==t)return`${t}`;if("string"==e)return`"${t}"`;if("symbol"==e){const e=t.description;return null==e?"Symbol":`Symbol(${e})`}if("function"==e){const e=t.name;return"string"==typeof e&&e.length>0?`Function(${e})`:"Function"}if(Array.isArray(t)){const e=t.length;let n="[";e>0&&(n+=v(t[0]));for(let r=1;r<e;r++)n+=", "+v(t[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(!(n&&n.length>1))return toString.call(t);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(t)+")"}catch(t){return"Object"}return t instanceof Error?`${t.name}: ${t.message}\n${t.stack}`:r}function y(){return r.rn_count()}let E=null;function x(t){const e=function(t,e){const n=e(4*t.length,4)>>>0;return(null!==E&&0!==E.byteLength||(E=new Float32Array(r.memory.buffer)),E).set(t,n/4),u=t.length,n}(t,r.__wbindgen_malloc),n=u;return r.gen_from_rn(e,n)}function L(t){if("number"!=typeof t)throw new Error("expected a number argument, found "+typeof t)}function A(t,e){t>>>=0;const n=p(),o=[];for(let a=t;a<t+4*e;a+=4)o.push(r.__wbindgen_export_2.get(n.getUint32(a,!0)));return r.__externref_drop_slice(t,e),o}function S(t,e,n){L(t),L(e),r.closure182_externref_shim(t,e,n)}Object.freeze({Cs420:0,0:"Cs420",Cs422:1,1:"Cs422",Cs444:2,2:"Cs444",Cs400:3,3:"Cs400"});const C="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((t=>r.__wbg_murreletmodel_free(t>>>0,1)));class k{static __wrap(t){t>>>=0;const e=Object.create(k.prototype);return e.__wbg_ptr=t,C.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,C.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_murreletmodel_free(t,0)}constructor(t){const e=f(t,r.__wbindgen_malloc,r.__wbindgen_realloc),n=u;return r.murreletmodel_new(e,n)}update_config(t){let e,n;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const o=f(t,r.__wbindgen_malloc,r.__wbindgen_realloc),a=u,s=r.murreletmodel_update_config(this.__wbg_ptr,o,a);return e=s[0],n=s[1],d(s[0],s[1])}finally{r.__wbindgen_free(e,n,1)}}update_frame(t,e,n,o,a,s){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr),function(t){if("bigint"!=typeof t)throw new Error("expected a bigint argument, found "+typeof t)}(t),w(s),r.murreletmodel_update_frame(this.__wbg_ptr,t,e,n,o,a,s)}canvas_ids(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const t=r.murreletmodel_canvas_ids(this.__wbg_ptr);var e=A(t[0],t[1]).slice();return r.__wbindgen_free(t[0],4*t[1],4),e}make_img_defs(){let t,e;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const n=r.murreletmodel_make_img_defs(this.__wbg_ptr);return t=n[0],e=n[1],d(n[0],n[1])}finally{r.__wbindgen_free(t,e,1)}}draw_err(){let t,e;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const n=r.murreletmodel_draw_err(this.__wbg_ptr);return t=n[0],e=n[1],d(n[0],n[1])}finally{r.__wbindgen_free(t,e,1)}}draw(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const t=r.murreletmodel_draw(this.__wbg_ptr);var e=A(t[0],t[1]).slice();return r.__wbindgen_free(t[0],4*t[1],4),e}illustrate(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const t=r.murreletmodel_illustrate(this.__wbg_ptr);var e=A(t[0],t[1]).slice();return r.__wbindgen_free(t[0],4*t[1],4),e}fps(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return L(this.__wbg_ptr),r.murreletmodel_fps(this.__wbg_ptr)}bg_color(){let t,e;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");L(this.__wbg_ptr);const n=r.murreletmodel_bg_color(this.__wbg_ptr);return t=n[0],e=n[1],d(n[0],n[1])}finally{r.__wbindgen_free(t,e,1)}}}const I="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((t=>r.__wbg_wasmmurreletmodelresult_free(t>>>0,1)));class M{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(t){t>>>=0;const e=Object.create(M.prototype);return e.__wbg_ptr=t,I.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,I.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_wasmmurreletmodelresult_free(t,0)}is_err(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return L(this.__wbg_ptr),0!==r.wasmmurreletmodelresult_is_err(this.__wbg_ptr)}err_msg(){let t,e;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const n=this.__destroy_into_raw();L(n);const o=r.wasmmurreletmodelresult_err_msg(n);return t=o[0],e=o[1],d(o[0],o[1])}finally{r.__wbindgen_free(t,e,1)}}to_model(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const t=this.__destroy_into_raw();L(t);const e=r.wasmmurreletmodelresult_to_model(t);return k.__wrap(e)}}function T(){const t={wbg:{}};return t.wbg.__wbg_call_672a4d21634d4a24=function(){return a((function(t,e){return t.call(e)}),arguments)},t.wbg.__wbg_call_7cccdd69e0791ae2=function(){return a((function(t,e,n){return t.call(e,n)}),arguments)},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(){return s((function(t,e){let n,o;try{n=t,o=e,console.error(d(t,e))}finally{r.__wbindgen_free(n,o,1)}}),arguments)},t.wbg.__wbg_new_23a2665fac83c611=function(){return s((function(t,e){try{var n={a:t,b:e};const o=new Promise(((t,e)=>{const o=n.a;n.a=0;try{return function(t,e,n,o){L(t),L(e),r.closure655_externref_shim(t,e,n,o)}(o,n.b,t,e)}finally{n.a=o}}));return o}finally{n.a=n.b=0}}),arguments)},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){return s((function(){return new Error}),arguments)},t.wbg.__wbg_newnoargs_105ed471475aaf50=function(){return s((function(t,e){return new Function(d(t,e))}),arguments)},t.wbg.__wbg_now_0bab97e4f4650974=function(){return s((function(){return Date.now()}),arguments)},t.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(){return s((function(t){queueMicrotask(t)}),arguments)},t.wbg.__wbg_queueMicrotask_d3219def82552485=function(){return s((function(t){return t.queueMicrotask}),arguments)},t.wbg.__wbg_resolve_4851785c9c5f573d=function(){return s((function(t){return Promise.resolve(t)}),arguments)},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(){return s((function(t,e){const n=f(e.stack,r.__wbindgen_malloc,r.__wbindgen_realloc),o=u;p().setInt32(t+4,o,!0),p().setInt32(t+0,n,!0)}),arguments)},t.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){return s((function(){const t="undefined"==typeof global?null:global;return g(t)?0:o(t)}),arguments)},t.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){return s((function(){const t="undefined"==typeof globalThis?null:globalThis;return g(t)?0:o(t)}),arguments)},t.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){return s((function(){const t="undefined"==typeof self?null:self;return g(t)?0:o(t)}),arguments)},t.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){return s((function(){const t="undefined"==typeof window?null:window;return g(t)?0:o(t)}),arguments)},t.wbg.__wbg_then_44b73946d2fb3e7d=function(){return s((function(t,e){return t.then(e)}),arguments)},t.wbg.__wbg_wasmmurreletmodelresult_new=function(){return s((function(t){return M.__wrap(t)}),arguments)},t.wbg.__wbindgen_array_new=function(){return[]},t.wbg.__wbindgen_array_push=function(t,e){t.push(e)},t.wbg.__wbindgen_cb_drop=function(t){const e=t.original;if(1==e.cnt--)return e.a=0,!0;const n=!1;return w(n),n},t.wbg.__wbindgen_closure_wrapper4476=function(){return s((function(t,e,n){const o=function(t,e,n,o){const a={a:t,b:e,cnt:1,dtor:183},s=(...t)=>{a.cnt++;const e=a.a;a.a=0;try{return o(e,a.b,...t)}finally{0==--a.cnt?(r.__wbindgen_export_6.get(a.dtor)(e,a.b),b.unregister(a)):a.a=e}};return s.original=a,b.register(s,a,a),s}(t,e,0,S);return o}),arguments)},t.wbg.__wbindgen_debug_string=function(t,e){const n=f(v(e),r.__wbindgen_malloc,r.__wbindgen_realloc),o=u;p().setInt32(t+4,o,!0),p().setInt32(t+0,n,!0)},t.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_export_2,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)},t.wbg.__wbindgen_is_function=function(t){const e="function"==typeof t;return w(e),e},t.wbg.__wbindgen_is_undefined=function(t){const e=void 0===t;return w(e),e},t.wbg.__wbindgen_number_new=function(t){return t},t.wbg.__wbindgen_string_new=function(t,e){return d(t,e)},t.wbg.__wbindgen_throw=function(t,e){throw new Error(d(t,e))},t}async function $(t){if(void 0!==r)return r;void 0!==t&&(Object.getPrototypeOf(t)===Object.prototype?({module_or_path:t}=t):console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===t&&(t=new URL(n(256),n.b));const e=T();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:o,module:a}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if("application/wasm"==t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,e);return function(t,e){return r=t.exports,$.__wbindgen_wasm_module=e,h=null,E=null,l=null,r.__wbindgen_start(),r}(o,a)}const R=$,O={time:{},ctx:""};function D(t){return Number.isInteger(parseInt(t))}function q(t){let e={};for(let n=0;n<t.length;n++){let r=t[n].path,o=t[n].value,a=r.split(".").slice(1),s=e,i=0;for(;i<a.length-1;){let t=a[i];const e=D(t);e&&(t=parseInt(t));const n=D(a[i+1]);if(e)for(let e=s.length;e<=t;e++)n?s.push([]):s.push({});else t in s||(s[t]=n?[]:{});s=s[t],i+=1}if(null!=o){let t=a[a.length-1];Number.isInteger(parseInt(t))&&(t=parseInt(t)),s[t]=o}}return e}function U(t,e){const n=document.createElement("div");if(e){let t=e.split(" ");for(let e=0;e<t.length;e++)n.classList.add(t[e])}return t.appendChild(n),n}function N(t,e,n,r){const o=document.createElement("input");return o.setAttribute("data-rust-path",n),o.classList.add(e),o.type="text",o.value=r,t.appendChild(o),o}function B(t,e,n){const r=document.createElement("span"),o=e.split(" ");for(let t=0;t<o.length;t++)r.classList.add(o[t]);return r.innerText=n,t.appendChild(r),r}function F(t,e){e.querySelectorAll(".enum-choice").forEach((e=>{const n=e.getAttribute("data-rust-path-enum-choice"),r=e.querySelectorAll("input, textarea");n==t?(e.classList.remove("collapsed"),e.classList.add("expanded"),r.forEach((t=>{t.setAttribute("data-rust-path-inactive",!1)}))):(e.classList.add("collapsed"),r.forEach((t=>{t.setAttribute("data-rust-path-inactive",!0)})))}))}function W(t){const e=document.createElement("button");return e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <line x1="12" y1="4" x2="12" y2="20" stroke="white" stroke-width="2" stroke-linecap="round"/>\n  <line x1="4" y1="12" x2="20" y2="12" stroke="white" stroke-width="2" stroke-linecap="round"/>\n</svg>',e.type="button",e.classList.add("list-add"),t.appendChild(e),e}function j(t,e){const n=document.createElement("label");n.textContent=e+":",t.appendChild(n)}function P(t,e){const n=U(t,"subtle-label");return n.textContent=e,n}function J(t){const e=document.createElement("button");return e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <line x1="4" y1="4" x2="20" y2="20" stroke="white" stroke-width="2" stroke-linecap="round"/>\n  <line x1="20" y1="4" x2="4" y2="20" stroke="white" stroke-width="2" stroke-linecap="round"/>\n</svg>',e.type="button",e.classList.add("struct-delete"),t.appendChild(e),e}function z(t){return t.replace(/[{}.\[\]]/g,(t=>{switch(t){case"{":case"}":case"[":case"}":return"";case".":return"-";default:return t}}))}function H(t,e){t.addEventListener("click",(function(t){t.preventDefault(),e.classList.contains("expanded")?(e.classList.remove("expanded"),e.classList.add("collapsed")):(e.classList.remove("collapsed"),e.classList.add("expanded"))}))}function V(t){if("[]"==t)return[]}class G{constructor(t){this.div=t}conf_update(t){!function(t){const e=document.querySelector("#editor > .struct");console.log(e);let n="flash-error";t&&(n="flash-success"),e&&(e.classList.add(n),setTimeout((()=>{e.classList.remove(n)}),500))}(t)}extract_rust_data(t){const e=t.querySelectorAll("[data-rust-path]");return Array.from(e).filter((t=>"true"!=t.getAttribute("data-rust-path-inactive"))).map((t=>({path:t.getAttribute("data-rust-path"),value:V(t.getAttribute("data-rust-value-override"))||t.value})))}extract_config(){return q(this.extract_rust_data(this.div))}build_html(t,e){this.add_item(this.div,[],t,e,{}),this.div.querySelectorAll("input, textarea").forEach((t=>{t.addEventListener("click",(function(){this.select()}))})),this.div.querySelectorAll(".struct-or-enum").forEach((t=>{const e=this.div;t.addEventListener("mousemove",(function(t){const n=e.querySelectorAll(".struct-or-enum:hover");e.querySelectorAll(".struct-or-enum.selected-struct-or-enum").forEach((t=>{t.classList.remove("selected-struct-or-enum")})),n.length>0&&n[n.length-1].classList.add("selected-struct-or-enum")}))}))}add_struct_field(t,e,n,r,o){let[a,s]=n;if("Skip"==s)return;const i=e+"."+a,l=U(t,"struct-field");let c;j(l,a),r&&a in r&&(c=r[a]),this.add_item(l,i,s,c,o)}add_struct(t,e,n,r,o){let[a,s]=n;const i=e;let l="struct struct-or-enum";o.isEnumItem&&(l="struct-in-enum");const c=U(t,l),d=U(c,"control-tools"),u=P(d,a);if("isDeletableIdx"in o){const t=J(d),[e,n,r,a]=o.isDeletableIdx;t.addEventListener("click",(()=>{this.delete_list_item_at(e,n,r,a)})),t.addEventListener("mouseenter",(()=>{t.closest("div.struct")?.classList.add("delete-warning")})),t.addEventListener("mouseleave",(()=>{t.closest("div.struct")?.classList.remove("delete-warning")})),delete o.isDeletableIdx}const _=B(u,"collapsed");_.innerText="...";const m=U(c,"expanded");for(let t=0;t<s.length;t++)this.add_struct_field(m,i,s[t],r,o);return H(u,m),H(u,_),c}add_enum(t,e,n,r,o){let[a,s]=n;const i="enum struct-or-enum",l=U(t,i),c=U(l,"control-tools"),d=P(c,a),u=B(d,"collapsed");if(u.innerText="...","isDeletableIdx"in o){const[t,e,n,r]=o.isDeletableIdx,a=J(c);a.addEventListener("click",(()=>{this.delete_list_item_at(t,e,n,r)})),a.addEventListener("mouseenter",(()=>{a.closest(`div.${i}`)?.classList.add("delete-warning")})),a.addEventListener("mouseleave",(()=>{a.closest(`div.${i}`)?.classList.remove("delete-warning")})),delete o.isDeletableIdx}const _=U(l,"expanded");j(_,"type");let m=[],f=[];for(let t=0;t<s.length;t++){let e=s[t];"Unnamed"in e&&(e=e.Unnamed,f.push(e),m.push(e[0])),"Unit"in e&&(e=e.Unit,f.push(e),m.push(e))}const h=r.type||m[0],p=(function(t,e,n,r,o){const a=document.createElement("select");a.setAttribute("data-rust-path",n),a.classList.add("enum-selector"),t.appendChild(a);for(let t=0;t<r.length;t++){const e=document.createElement("option");e.value=r[t],e.innerText=r[t],r[t]==o&&(e.selected=!0),a.appendChild(e)}a.addEventListener("change",(function(){F(this.value,t)}))}(_,0,e+".type",m,h),U(_,"enum-edit"));for(let t=0;t<f.length;t++){let n,a;console.log(f[t]),2==f[t].length?(n=f[t][0],a=f[t][1]):1==f[t].length?n=f[t]:console.log("corrected fields",f[t]),console.log("EEE",n);const s=U(p,"enum-choice");if(s.setAttribute("data-rust-path-enum-choice",n),a){let t;n==h&&(t=r),this.add_item(s,e,a,t,{...o,isEnumItem:!0})}}F(h,_),H(d,_),H(d,u)}insert_list_item_at(t,e,n,r){let o=this.extract_rust_data(t),a=[];for(let t=0;t<o.length;t++){let n=o[t],s=n.path.replace(new RegExp(`(${e}\\.)\\d+`),((t,e)=>{const n=parseInt(t.replace(e,""),10);return n>=r?`.dummy.${n+1}`:`.dummy.${n}`}));if(s==e&&(s=".dummy"),!s.startsWith(".dummy"))throw new Error(`${s} did not start with ${e}`);a.push({path:s,value:n.value})}a.push({path:`.dummy.${r}`,value:{}});const s=q(a);t.innerHTML="",this.add_list(t,e,n,s.dummy)}delete_list_item_at(t,e,n,r){let o=this.extract_rust_data(t),a=[];for(let t=0;t<o.length;t++){let n=o[t];if(n.path.startsWith(e+"."+r));else{let t=n.path.replace(new RegExp(`(${e}\\.)\\d+`),((t,e)=>{const n=parseInt(t.replace(e,""),10);return n>=r?(console.log("moving down",n),".dummy."+(n-1)):(console.log("leaving",n,"alone"),`.dummy.${n}`)}));if(t==e&&(t=".dummy"),!t.startsWith(".dummy"))throw new Error(`${t} did not start with ${e}`);a.push({path:t,value:n.value})}}const s=q(a);t.innerHTML="",this.add_list(t,e,n,s.dummy)}add_list(t,e,n,r,o){const a=e,s=U(t),i=U(s,"list");i.setAttribute("data-rust-path",a),i.setAttribute("data-rust-value-override","[]");const l=P(i,""),c=B(l,"collapsed");c.innerText="...";const d=U(i,"expanded");W(d).addEventListener("click",(()=>{this.insert_list_item_at(s,a,n,0)}));let u=r||[];for(let t=0;t<u.length;t++){const e={...o,isDeletableIdx:[s,a,n,t]};this.add_item(d,a+"."+t,n,u[t],e),W(d).addEventListener("click",(()=>{this.insert_list_item_at(s,a,n,t+1)}))}H(l,d),H(l,c)}input_val_num(t,e,n){N(t,"val-num",e,n||0)}input_val_vec2(t,e,n){null==n&&(n=[0,0]),B(t,"val-vec2-label","("),N(t,"val-vec2",e+".0",n[0]),B(t,"val-vec2-label",","),N(t,"val-vec2",e+".1",n[1]),B(t,"val-vec2-label",")")}input_val_angle(t,e,n){N(t,"val-angle",e,n||0)}input_val_defs(t,e,n){!function(t,e,n,r){const o=document.createElement("textarea");o.setAttribute("data-rust-path",n),o.classList.add("val-def"),o.value=r,t.appendChild(o)}(t,0,e,n||"")}input_ref_defs(t,e,n){N(t,"val-ref",e,n||"a")}input_val_color(t,e,n){B(t,"val-color-label","[");let r=n;null==n&&(r=[0,0,1,1]),N(t,"val-color",e+".0",r[0],z(e)),B(t,"val-color-label",","),N(t,"val-color",e+".1",r[1],z(e)),B(t,"val-color-label",","),N(t,"val-color",e+".2",r[2],z(e)),B(t,"val-color-label",","),N(t,"val-color",e+".3",r[3],z(e)),B(t,"val-color-label",")")}add_val(t,e,n,r){if("Num"==n){const n=U(t,"val-num-container");this.input_val_num(n,e,r)}else if("Vec2"==n){const n=U(t,"val-vec2-container");this.input_val_vec2(n,e,r)}else if("Angle"==n){const n=U(t,"val-angle-container");this.input_val_angle(n,e,r)}else if("Color"==n){const n=U(t,"val-color-container");this.input_val_color(n,e,r)}else if("Defs"==n){const n=U(t,"val-defs-container");this.input_val_defs(n,e,r)}else if("object"==typeof n&&"Name"in n){const n=U(t,"val-ref-str-container");this.input_ref_defs(n,e,r)}else console.log("MISSING VAL",n)}add_item(t,e,n,r,o){if("Skip"!=n)for(const a in n){let s=n[a];if("Struct"==a)return t.classList.add("struct-field-nested"),this.add_struct(t,e,s,r,o);if("Enum"==a)return t.classList.add("struct-field-nested"),this.add_enum(t,e,s,r,o);if("List"==a)return t.classList.add("struct-field-nested"),this.add_list(t,e,s,r,o);if("Val"==a)return t.classList.add("struct-field-val"),this.add_val(t,e,s,r,o);"Skip"==a||console.log("Missing item type!",s)}}}async function X(t,e){let n=e.extract_config();console.log(n);let r={app:O,drawing:n};console.log("reloading");let o=await t.reload(r);if(console.log("done"),console.log(o),o)e.conf_update(!1),console.log("ERR",o);else{let r=JSON.stringify(n);const o=encodeURIComponent(r),a=new URLSearchParams(window.location.search);a.set("conf",o);const s=`${window.location.pathname}?${a.toString()}`;history.replaceState(null,"",s),e.conf_update(!0),await t.updateAndDraw()}}const Y="http://www.w3.org/2000/svg";let K=!1;const Q=Math.pow(10,4);let Z;function tt(t){let e=[];for(let r=0;r<t.length;r++)e.push((n=Math.round(t[r]*Q)/Q)>=1?(Q-1)/Q:n<0?0:n);var n;return e}function et(t){let e=[];for(let n=0;n<t.length;n++)e.push(String(Math.round(t[n]*Q)).padStart(4,"0"));return e.join("-")}function nt(t){let e=t.split("-"),n=[];for(let t=0;t<e.length;t++)n.push(parseInt(e[t])/Q);return n}function rt(){return nt(new URLSearchParams(window.location.search).get("cubed"))}const ot={time:{},ctx:""};class at{constructor(t){this.murrelet=null,this.svg=t,this.mouse_x=0,this.mouse_y=0,this.mouse_down=!1,this.dim_x=600,this.dim_y=600,this.frame=1n,this.fps=30,this.lastUpdate=performance.now()}async initModel(t){console.log("init model");try{let e=await function(t){const e=f(t,r.__wbindgen_malloc,r.__wbindgen_realloc),n=u;return r.new_model(e,n)}(t);e.is_err()?(console.log(t),console.log("ERROR",e.err_msg()),document.getElementById("err_msg").innerHTML=e.err_msg()):(this.murrelet=e.to_model(),console.log("model init"))}catch(t){console.error("init failed",t)}}paths(){return this.svg.getElementById("paths")}async reload(t){var e="";const n=JSON.stringify(t);return null===this.murrelet&&await this.initModel(n),null!==this.murrelet&&("Success!"==(e=this.murrelet.update_config(n))&&(e=this.murrelet.draw_err()),this.fps=this.murrelet.fps(),this.updateWindowSize()),e}updateMurreletWithWorld(){null!==this.murrelet&&this.murrelet.update_frame(this.frame,this.dim_x,this.dim_y,this.mouse_x,this.mouse_y,this.mouse_down)}updateWindowSize(){const t=this.svg.getBoundingClientRect();this.dim_x=t.width,this.dim_y=t.height}mouseMove(t){const e=this.svg.getBoundingClientRect();this.mouse_x=t.clientX-e.left,this.mouse_y=t.clientY-e.top}mouseDown(){this.mouseDown=!0}mouseUp(){this.mouseDown=!1}updateAndDraw(){if(null!==this.murrelet){const t=performance.now();{let e;this.updateMurreletWithWorld(),K?(console.log("illustrate"),e=this.murrelet.illustrate()):e=this.murrelet.draw(),this.paths().innerHTML=e[1],this.lastUpdate=t,this.bgColor=this.murrelet.bg_color(),this.svg.style.backgroundColor=this.bgColor}this.frame+=1n}}async updateTextures(){if(null!==this.murrelet){let t=this.murrelet.canvas_ids();for(let e=0;e<t.length;e++){let n=t[e];this.canvasToImg(n+"Canvas",n+"Img")}}}canvasToImg(t,e){const n=document.getElementById(e);if(!n)return void console.log("no svg yet");const r=document.getElementById(t).toDataURL("image/png");n.setAttribute("href",r)}}async function st(t,e){const n=function(t){let e=t.length,n=Array.from({length:e},(()=>1)),r=Array.from({length:e},(()=>0));return gt.forEach((t=>{let e=pt[t].state;console.log(e);let o=pt[t].embedding;if("lock"==e&&o){let e=nt(o);bt[t].forEach((t=>{n[t]=0,r[t]=e[t]}))}else"default"==e&&bt[t].forEach((t=>{n[t]=0,r[t]=.5}))})),function(t,e){let n=[];for(let r=0;r<t.length;r++)n.push(t[r]+e[r]);return n}(function(t,e){let n=[];for(let r=0;r<t.length;r++)n.push(t[r]*e[r]);return n}(t,n),r)}(e),r=await x(n),o=JSON.parse(r),a={app:ot,drawing:o};let s=await t.reload(a);return""!=s?(console.log(r),console.log(s),!1):(t.updateAndDraw(),!0)}function it(t=0,e=1){let n=0,r=0;for(;0===n;)n=Math.random();for(;0===r;)r=Math.random();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*r)*e+t}const lt=800,ct=800;function dt(t,e){const n=e.getElementById("paths"),r=n.getBBox(),o=ct/2,a=lt/2-(r.x+r.width/2),s=o-(r.y+r.height/2);n.setAttribute("transform",`translate(${a}, ${s})`),t.classList.add("visible")}function ut(t){let e=document.createElementNS(Y,"svg");e.setAttribute("viewBox","0 0 800 800");let n=document.createElementNS(Y,"g");return n.id="paths",e.appendChild(n),t.appendChild(e),e}async function _t(t,e){let n;for(let r=0;r<30&&(n=Array.from({length:e},(()=>Math.random())),!await st(t,n));r++)console.log("trying again");return n}let mt=!1,ft=null;async function ht(t){if(mt)return;mt=!0;const e=document.body.clientWidth,n=Math.floor(e/201),r=Math.floor(500/174),o=Math.max(n*r,10),a=5*Math.floor(o/5);var s=new at;let i=await y(),l=0;for(let e=0;e<a;e++){let e;for(let n=0;n<5;n++){let r=document.createElement("div");r.classList.add("explore-example"),t.appendChild(r);const o=ut(r);let a;s.svg=o,0==n?(e=await _t(s,i),a=e):(a=tt(e.map((t=>t+it(0,.05)))),await st(s,a)||(console.log("invalid, starting over"),a=await _t(s,i))),r.setAttribute("data-embedding",et(a)),r.addEventListener("click",(()=>{const t=new URL(window.location.href);t.searchParams.set("cubed",r.getAttribute("data-embedding")),window.location.href=t.toString(),history.pushState(null,"",t.toString())})),r.addEventListener("contextmenu",(t=>{t.preventDefault(),document.querySelectorAll(".state-button").forEach((t=>{const e=t.textContent.split(":")[0];t.classList.remove("state-free","state-default","state-lock"),t.classList.add("state-tlock"),t.setAttribute("data-state","tlock"),t.textContent=`${e}: lock?`,ft=r.getAttribute("data-embedding"),pt[e].embedding=ft}))})),requestAnimationFrame((()=>{requestAnimationFrame((()=>{dt(r,o)}))})),await new Promise((t=>setTimeout(t,10))),l+=1}}mt=!1}let pt=JSON.parse(sessionStorage.getItem("stages_states")||"{}");const gt=["rectangle","chomps","triangulation","fill"],wt=["free","lock","default"];let bt={};function vt(t,e){pt[t].state=e,console.log(`updated state of ${t} to ${e}`),sessionStorage.setItem("stages_states",JSON.stringify(pt)),function(t){let e=document.getElementById(`stage-${t}`);const n=pt[t].state;e.textContent=`${t}: ${n}`,wt.forEach((t=>{e.classList.remove(`state-${t}`)})),e.classList.add(`state-${n}`)}(t)}async function yt(){let t=document.createElement("div");t.classList.add("sticky-element"),document.body.appendChild(t);let e=document.createElement("div");e.classList.add("container"),e.id="exploreContainer",document.body.appendChild(e);let n=document.createElement("div");n.classList.add("explore-flex"),e.appendChild(n);for(let e=0;e<gt.length;e++){let o=gt[e],a=pt[o].state,s=document.createElement("div");s.classList.add("state-button"),s.classList.add(`state-${a}`),s.id=`stage-${o}`,s.setAttribute("data-state",a);let i=document.createElement("div");i.classList.add("state-text"),i.textContent=`${o}: ${a}`,s.appendChild(i);let l=document.createElement("div");l.classList.add("lockpreview"),s.appendChild(l);let c=ut(l);s.addEventListener("click",(async()=>{if("tlock"==s.getAttribute("data-state")){s.setAttribute("data-lock-embedding",ft),console.log(ft);var t=new at;t.svg=c,await st(t,nt(ft)),console.log(c),vt(o,"lock"),r()}else{let t=pt[o].state,e=wt.indexOf(t),n=wt[(e+1)%wt.length];vt(o,n)}n.innerHTML="",ht(n)})),t.appendChild(s)}function r(){document.querySelectorAll(".state-button[data-state='tlock']").forEach((t=>{const e=t.textContent.split(":")[0];t.classList.remove("state-tlock");const n=pt[e].state;t.classList.add(`state-${n}`),t.setAttribute("data-state",n),console.log("STATE",t.querySelector(".state-text")),t.textContent=`${e}: ${n}`}))}document.addEventListener("keydown",(t=>{"Escape"===t.key&&r()}));const o=function(t){let e=0;return function(...n){const r=Date.now();r-e>=100&&(e=r,t.apply(this,n))}}((()=>{e.scrollTop+e.clientHeight>=e.scrollHeight-300&&ht(n)}));e.addEventListener("scroll",o),ht(n)}function Et(t,e,n,r,o,a,s){let i=[];for(let l=0;l<t.length;l++)i.push(t[l]+o*e[l]+a*n[l]+s*r[l]);return tt(i)}function xt(t){let e=Array.from({length:t},(()=>Math.random()));const n=e.reduce(((t,e)=>t+e),0);return e.map((t=>t/n))}function Lt(t,e){return t.map((t=>t*e))}gt.forEach((t=>{pt.hasOwnProperty(t)||(pt[t]={state:"free"})}));let At=30;const St="silverspot-keyframes";async function Ct(t,e,n){if(mt)return;mt=!0;let r=n.length;const o=xt(r),a=xt(r),s=xt(r);let i=Lt(o,At*r/100),l=Lt(a,At*r/100),c=Lt(s,At*r/100);for(let r=0;r<7;r++)for(let o=0;o<7;o++){let a=e[o][r];const s=a.getAttribute("data-qrs"),[d,u,_]=s.split(",").map(Number),m=0==d&&0==u&&0==_;if(Math.abs(d)>3||Math.abs(u)>3||Math.abs(_)>3);else{let e=Et(n,i,l,c,d/3,u/3,_/3),r=a.querySelectorAll("svg");const o=ut(a);o.classList.add("cube-row-box-wrapper"),t.svg=o,await st(t,e),m&&(document.body.style.backgroundColor=t.bgColor),a.setAttribute("data-embedding",et(e)),r&&setTimeout((()=>{r.forEach((t=>{t.remove()}))}),1e3),requestAnimationFrame((()=>{requestAnimationFrame((()=>{dt(a,o)}))})),await new Promise((t=>setTimeout(t,1))),o.offsetWidth,o.classList.add("fade-in")}}mt=!1}async function kt(t){return await async function(t){const e=(new TextEncoder).encode(et(t)),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("").slice(0,12)}(t)}async function It(t,e,n){const r=document.createElement("canvas");r.width=224,r.height=224;const o=r.getContext("2d"),a=(new XMLSerializer).serializeToString(t),s=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(s);return new Promise((t=>{const a=new Image;a.onload=()=>{o.drawImage(a,0,0),URL.revokeObjectURL(i);const s=JSON.stringify({vectors:e});r.toBlob((e=>{const r=new File([e],n,{type:"image/png"}),o=new FormData;o.append("file",r),o.append("metadata",s);const a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),t()}),"image/png")},a.src=i}))}!async function(){await R(),Z=await r.rn_names(),gt.forEach((t=>{let e=[];Z.forEach(((n,r)=>{n.startsWith(t)&&e.push(r)})),bt[t]=e})),console.log(bt),K=!1;const t=new URLSearchParams(window.location.search);if(t.has("perterb")){const e=t.get("cubed"),n=t.get("perterb"),r=t.get("idx");await async function(t,e,n){const r=nt(t),o=document.createElement("select");o.id="default-select",document.body.appendChild(o);const a=document.createElement("select");a.id="indexSelect",document.body.appendChild(a);let s=n;n||(s=Math.floor(Math.random()*r.length));let i=document.createElement("pre");i.innerText=s+"\n",document.body.appendChild(i);let l=document.createElement("div"),c=document.createElement("div");c.addEventListener("input",(async()=>{scrollBox.innerText=c.value,At=c.value;let t=rt();await Ct(_,divs,t)})),document.body.appendChild(l);let d=document.createElement("div");d.classList.add("container"),document.body.appendChild(d);let u=document.createElement("div");u.classList.add("perterb-row-doc"),d.appendChild(u);var _=new at;Array(r.length).fill(0)[s]=parseFloat(e);for(let t=0;t<5;t++){let e=r.map((t=>t));e[s]=t/4;let n=document.createElement("div");n.classList.add("perterb-container"),u.appendChild(n),2==t&&n.classList.add("perterb-center"),n.setAttribute("data-embedding",et(r)),n.addEventListener("mouseover",(async()=>{let t=await x(e);m.innerHTML=JSON.stringify(JSON.parse(t),null,"\t")}));const o=ut(n);_.svg=o,await st(_,e),requestAnimationFrame((()=>{requestAnimationFrame((()=>{dt(n,o)}))}))}let m=document.createElement("pre");m.classList.add("perterb-row-doc"),d.appendChild(m);const f=r.length;for(let t=0;t<f;t++){let e=document.createElement("option");e.value=t,e.textContent=t,a.appendChild(e)}const h=new URLSearchParams(window.location.search).get("idx");null!==h&&(a.value=h),a.addEventListener("change",(function(){const t=a.value,e=new URL(window.location.href);e.searchParams.set("idx",t),window.location.href=e.toString()}));let p=await x(r);m.innerHTML=JSON.stringify(JSON.parse(p),null,"\t")}(e,n,r)}else if(t.has("edit")){K=!0;const e=t.get("cubed");await async function(t){const e=nt(t);let n=await x(e);console.log(n);let o=JSON.parse(n),a=document.createElement("div");a.id="editor";let s=document.createElement("div"),i=document.createElement("div");s.appendChild(i);const l=document.createElement("button");l.id="submit",l.textContent="submit",s.appendChild(l),s.appendChild(a);let c=document.createElement("div");c.id="editview";let d=ut(c),u=document.createElement("div");u.classList.add("container"),u.appendChild(c),u.appendChild(s),document.body.appendChild(u);var _=new G(a);let m=await r.gui_schema(),f=JSON.parse(m);_.build_html(f,o);var h=new at(d);function p(){h.updateAndDraw()}l.onclick=async()=>{console.log("updating"),await X(h,_),console.log("updated")},h.updateWindowSize(),a.addEventListener("keydown",(async t=>{t.metaKey&&"Enter"===t.key&&(t.preventDefault(),await X(h,_),p())})),await X(h,_),p(),dt(c,d)}(e)}else if(t.has("cubed")){const e=t.get("cubed"),[n,r,o]=await async function(t){let e=document.createElement("div");e.classList.add("cube-row-doc"),document.body.appendChild(e);let n=document.createElement("div");n.classList.add("cube-holder"),e.appendChild(n);const r=document.createElement("a"),o=window.location.origin+window.location.pathname.split("/").slice(0,-1).join("/");r.href=o,r.innerText="â† Back",r.classList.add("back-button"),document.body.appendChild(r);const a=document.createElement("div");a.classList.add("slider-container");const s=document.createElement("input");s.type="range",s.min="1",s.max="100",s.value=At,s.classList.add("scroll-slider");const i=document.createElement("div");i.classList.add("scroll-box"),i.innerText=At,a.appendChild(i),a.appendChild(s),document.body.appendChild(a),s.addEventListener("input",(async()=>{i.innerText=s.value,At=s.value;let t=rt();await Ct(c,d,t)}));const l=nt(t);var c=new at;const d=function(t,e){let n=document.createElement("div");n.classList.add("dark-overlay"),document.body.appendChild(n);let r=[];for(let e=0;e<7;e++){let n=document.createElement("div");n.classList.add("cube-row-container"),n.style.height="180px",n.style.width="1260px",t.appendChild(n);let o=[];for(let t=0;t<7;t++){let r=document.createElement("div");r.classList.add("cube-row-box"),r.style.height="180px",n.appendChild(r);let a=t-3,s=e-3;t%2==0&&(r.style.transform="translateY(90px)");let i=a,l=s-Math.floor(i/2),c=-i-l;r.setAttribute("data-qrs",`${i},${l},${c}`),o.push(r)}r.push(o)}for(let t=0;t<7;t++)for(let n=0;n<7;n++){const o=r[t][n],a=o.getAttribute("data-qrs"),[s,i,l]=a.split(",").map(Number);Math.abs(s)>3||Math.abs(i)>3||Math.abs(l)>3||(o.addEventListener("click",(()=>{let t=o.getAttribute("data-embedding");const n=new URL(window.location.href);n.searchParams.set("cubed",t),history.pushState(null,"",n.toString()),Ct(e,r,nt(t))})),o.addEventListener("contextmenu",(t=>{t.preventDefault();let e=o.getAttribute("data-embedding"),n=localStorage.getItem(St),r=[];for(n&&(r=n.split(",")),r.push(e);r.length>30;)r.shift();console.log(r.length,"items"),localStorage.setItem(St,r.join(","))})))}return r}(n,c);return[c,d,l]}(e);await Ct(n,r,o)}else t.has("download")?await async function(){var t=new at(document.getElementById("frame"));const e=document.createElement("div");document.body.appendChild(e);let n=await y();const r=ut(e);t.svg=r;const o="FilenameToRN";let a=JSON.parse(localStorage.getItem(o))||{};for(let o=0;o<10;o++){const o=await _t(t,n);if(await st(t,o),dt(e,r),r){const t=await kt(o);It(r,o,`${t}.png`),a[`${t}.png`]=o}}localStorage.setItem(o,JSON.stringify(a));const s=document.createElement("div");document.body.appendChild(s),s.innerText=JSON.stringify(a)}():t.has("playback")?await async function(){let t=(localStorage.getItem(St)||"").split(",").map((t=>nt(t)));const e=document.createElement("div");e.classList.add("animate-box"),document.body.appendChild(e);let n=0,r=Date.now();var o=new at(document.getElementById("frame"));!async function a(){if(Date.now()-r>60){let a=function(t,e,n){let r=[];for(let o=0;o<t.length;o++)r.push((1-n)*t[o]+n*e[o]);return r}(t[Math.floor(n/50)%t.length],t[(Math.floor(n/50)+1)%t.length],n%50/50),s=e.querySelectorAll("svg");await y();const i=ut(e);o.svg=i,i.classList.add("animate-box"),await st(o,a),dt(e,i),await new Promise((t=>setTimeout(t,1))),i.offsetWidth,i.classList.add("visible"),s&&setTimeout((()=>{s.forEach((t=>{t.remove()}))}),500),n+=1,r=Date.now()}requestAnimationFrame(a)}()}():await yt()}()})();